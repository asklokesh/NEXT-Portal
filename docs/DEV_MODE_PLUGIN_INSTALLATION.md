# What Actually Happens in Dev Mode When You Click "Install Plugin" ## Quick Answer In dev mode on your local machine, when you click "Install Plugin", the system **simulates** the installation process but doesn't actually modify your Backstage instance yet. Here's what really happens: ## Current Implementation in Dev Mode ### 1. Frontend Action ``` User clicks "Install" â†’ API call to /api/plugins/install ``` ### 2. Backend Processing Steps #### Step 1: Task Creation & Tracking ```javascript // Creates an in-memory task with status tracking const task = { id: taskId, pluginId: '@backstage/plugin-catalog', status: 'pending', progress: 0, message: 'Installation queued' } ``` #### Step 2: Validation Phase (10% progress) - Validates plugin compatibility - Checks configuration schema - Verifies dependencies - **Real validation against NPM registry** #### Step 3: Installation Phase (30-80% progress) Based on your environment, it tries different approaches: **Primary Path (if Docker is available):** ```bash # Attempts to use Docker container docker exec backstage-plugin-installer /app/install-plugin.sh ``` - Runs in isolated Docker container - Installs NPM packages in container - Updates configuration files in mounted volume **Fallback Path (if Docker fails):** ```javascript // Falls back to local installation pluginInstaller.installPlugin(pluginId, version) ``` - Attempts to install NPM package locally - Updates local Backstage configuration files - Modifies app-config.yaml #### Step 4: Configuration Phase (85% progress) - Applies plugin configuration - Updates environment variables - Modifies YAML config files #### Step 5: Completion (100% progress) - Updates task status to 'completed' - Returns success response - **Plugin is installed but Backstage needs restart** ## What Files Are Actually Modified ### If Installation Succeeds: 1. **`backstage/package.json`** ```json { "dependencies": { "@backstage/plugin-catalog": "^1.15.0" // Added } } ``` 2. **`backstage/app-config.yaml`** ```yaml # Plugin configuration added catalog: providers: github: enabled: true ``` 3. **`backstage/packages/app/src/App.tsx`** (attempted) ```javascript import { CatalogPlugin } from '@backstage/plugin-catalog'; // Plugin import added ``` ## Current Limitations in Dev Mode ### What DOESN'T Happen Automatically: 1. **No Automatic Restart** - Backstage dev server needs manual restart - Changes don't take effect until restart 2. **No Hot Reload** - Plugin isn't immediately available - Requires stopping and starting dev server 3. **Partial Integration** - Some plugins need manual code changes - Route registration might be incomplete 4. **Database Not Updated** - Plugin record created in database - But actual Backstage instance not fully integrated ## How to Make It Actually Work in Dev Mode ### Option 1: Manual Steps After Installation ```bash # 1. Stop your current Backstage dev server Ctrl+C # 2. Navigate to Backstage directory cd backstage # 3. Install the plugin manually (if auto-install failed) npm install @backstage/plugin-catalog # 4. Restart Backstage npm run dev ``` ### Option 2: Use the Docker Development Environment ```bash # 1. Ensure Docker is running docker-compose -f docker-compose.plugins.yml up -d # 2. Click install in the UI # Plugin installs in Docker container # 3. Access containerized Backstage http://localhost:7007 ``` ### Option 3: Enable Full Local Installation Set these environment variables: ```bash # .env.local BACKSTAGE_DIR=/path/to/your/backstage PLUGIN_INSTALL_MODE=local AUTO_RESTART_ENABLED=true ``` ## What the System is Trying to Do The current implementation attempts to: 1. **Validate** - Check if plugin is compatible (Works) 2. **Download** - Get plugin from NPM (Partial) 3. **Install** - Add to package.json (Partial) 4. **Configure** - Update app-config.yaml (Partial) 5. **Register** - Add to App.tsx (Usually fails) 6. **Restart** - Reload Backstage (Manual required) ## Actual Working Flow for Dev Mode ### Currently Working: - UI shows installation progress - Database records created - Validation against NPM - Configuration UI works - Health monitoring UI works ### Requires Manual Intervention: - NPM package installation - Backstage restart - Plugin registration in code - Route configuration ## Enhanced Dev Mode (What Could Be Implemented) To make it fully work in dev mode, we would need: ```javascript // Enhanced plugin installer for dev mode class DevModePluginInstaller { async installPlugin(pluginId, version) { // 1. Install NPM package await exec(`cd ${BACKSTAGE_DIR} && npm install ${pluginId}@${version}`); // 2. Auto-register in App.tsx await this.registerPlugin(pluginId); // 3. Update config await this.updateConfig(pluginId); // 4. Restart dev server await this.restartDevServer(); // 5. Wait for health check await this.waitForHealthy(); } } ``` ## Summary **What Currently Happens:** 1. Shows nice UI with progress 2. Creates database records 3. Attempts to install NPM package (may fail) 4. Tries to update config files (partial success) 5. Doesn't restart Backstage 6. Plugin not immediately available **To Actually Use the Plugin:** - You need to manually restart your Backstage dev server - May need to manually run `npm install` in backstage directory - Some plugins require manual code changes **Best Practice for Dev Mode:** 1. Use the UI to discover and validate plugins 2. Note the plugin name and version 3. Manually install using npm 4. Restart your dev server 5. Configure through the UI The system provides a great UI/UX for plugin management but requires some manual steps in dev mode to complete the actual integration with your local Backstage instance.