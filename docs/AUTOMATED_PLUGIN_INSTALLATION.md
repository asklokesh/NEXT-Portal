# Automated Plugin Installation for Local Development ## Overview The enhanced local plugin installer provides **fully automated plugin installation** that mirrors production behavior in your local development environment. When you click "Install Plugin", the system will: 1. Download and install the NPM package 2. Update `package.json` with the dependency 3. Modify `app-config.yaml` with plugin configuration 4. Update `App.tsx` or `index.ts` to import and register the plugin 5. Install peer dependencies automatically 6. Build the backend if needed 7. Restart the Backstage dev server 8. Wait for health checks to confirm success **No manual intervention required!** ## Quick Start ### 1. Initial Setup ```bash # Run the setup script ./scripts/setup-local-plugin-installer.sh # Or manually configure cp .env.local.example .env.local # Edit .env.local to set BACKSTAGE_ROOT to your Backstage directory ``` ### 2. Configuration Update `.env.local` with your settings: ```env # REQUIRED: Path to your Backstage installation BACKSTAGE_ROOT=./backstage # Enable full automation USE_ENHANCED_INSTALLER=true AUTO_RESTART_ENABLED=true AUTO_UPDATE_CODE=true # Optional: Customize timeouts NPM_INSTALL_TIMEOUT=300000 # 5 minutes BACKSTAGE_RESTART_TIMEOUT=60000 # 1 minute ``` ### 3. Start the Portal ```bash npm run dev ``` ### 4. Install a Plugin 1. Navigate to http://localhost:4400/plugins 2. Click "Browse Marketplace" or "Discover Plugins" 3. Select a plugin and click "Install" 4. Watch the real-time progress 5. Plugin is automatically installed and Backstage restarts 6. Your plugin is ready to use! ## How It Works ### Installation Flow ```mermaid graph TD A[Click Install] --> B[Validate Backstage Directory] B --> C[NPM Install Package] C --> D[Update app-config.yaml] D --> E{Plugin Type?} E -->|Frontend| F[Update App.tsx] E -->|Backend| G[Update backend/index.ts] F --> H[Install Peer Dependencies] G --> H H --> I[Build Backend if Needed] I --> J[Stop Current Dev Server] J --> K[Start New Dev Server] K --> L[Health Check] L --> M[Installation Complete] ``` ### What Gets Modified #### 1. **NPM Package Installation** ```bash # Automatically runs in your Backstage directory cd ./backstage npm install @backstage/plugin-catalog@latest --save ``` #### 2. **app-config.yaml Updates** ```yaml # Automatically added catalog: providers: github: - host: github.com token: ${GITHUB_TOKEN} app: plugins: - @backstage/plugin-catalog ``` #### 3. **App.tsx Updates (Frontend Plugins)** ```typescript // Automatically added import import { CatalogPlugin } from '@backstage/plugin-catalog'; // Automatically added to routes <FlatRoutes> {/* existing routes */} <CatalogPlugin /> </FlatRoutes> ``` #### 4. **backend/index.ts Updates (Backend Plugins)** ```typescript // Automatically added import import catalog from '@backstage/plugin-catalog-backend'; // Automatically added to backend backend.add(catalog()); ``` ## Supported Plugins The system automatically handles installation for all standard Backstage plugins: ### Core Plugins (Fully Automated) - @backstage/plugin-catalog - @backstage/plugin-techdocs - @backstage/plugin-scaffolder - @backstage/plugin-search - @backstage/plugin-user-settings ### Integration Plugins (Fully Automated) - @backstage/plugin-kubernetes - @backstage/plugin-github-actions - @backstage/plugin-jenkins - @backstage/plugin-circleci - @backstage/plugin-azure-devops ### Monitoring Plugins (Fully Automated) - @backstage/plugin-pagerduty - @backstage/plugin-sentry - @backstage/plugin-rollbar - @backstage/plugin-newrelic ### Custom/Community Plugins - Any NPM package following Backstage plugin conventions - Private registry plugins (configure NPM_REGISTRY_URL) ## Advanced Configuration ### Custom Plugin Mappings For plugins with non-standard names, add to `src/services/enhancedLocalPluginInstaller.ts`: ```typescript private normalizePackageName(pluginId: string): string { // Add your custom mappings if (pluginId === 'my-custom-plugin') { return '@mycompany/backstage-plugin-custom'; } // ... existing logic } ``` ### Disable Auto-Restart To install without restarting (manual restart later): ```env AUTO_RESTART_ENABLED=false ``` ### Custom Backstage Location If your Backstage is in a different location: ```env BACKSTAGE_ROOT=/Users/yourname/projects/my-backstage ``` ### Monorepo Support For monorepo setups: ```env BACKSTAGE_ROOT=../../packages/backstage ``` ## Troubleshooting ### Plugin Not Appearing After Installation 1. **Check Installation Logs** ```bash tail -f logs/plugin-installations/*.log ``` 2. **Verify Package Installation** ```bash cd backstage npm list @backstage/plugin-[name] ``` 3. **Check App.tsx Updates** ```bash grep -n "plugin-name" backstage/packages/app/src/App.tsx ``` 4. **Manual Restart** ```bash cd backstage npm run dev ``` ### Installation Fails 1. **Permission Issues** ```bash # Fix npm permissions sudo chown -R $(whoami) ~/.npm sudo chown -R $(whoami) ./backstage/node_modules ``` 2. **Port Already in Use** ```bash # Kill processes on Backstage ports lsof -ti:3000 | xargs kill -9 lsof -ti:7007 | xargs kill -9 ``` 3. **Clear NPM Cache** ```bash npm cache clean --force ``` ### Backstage Won't Restart 1. **Check Process** ```bash ps aux | grep node | grep backstage ``` 2. **Manual Stop and Start** ```bash # Stop all Node processes pkill -f node # Restart manually cd backstage && npm run dev ``` ## Environment Variables | Variable | Default | Description | |----------|---------|-------------| | `USE_ENHANCED_INSTALLER` | `true` | Enable automated installation | | `BACKSTAGE_ROOT` | `./backstage` | Path to Backstage directory | | `AUTO_RESTART_ENABLED` | `true` | Auto-restart after install | | `AUTO_UPDATE_CODE` | `true` | Update App.tsx/index.ts | | `NPM_INSTALL_TIMEOUT` | `300000` | NPM install timeout (ms) | | `BACKSTAGE_RESTART_TIMEOUT` | `60000` | Dev server restart timeout | | `CREATE_BACKUP_BEFORE_INSTALL` | `true` | Backup files before changes | ## Testing ### Test Installation Without UI ```javascript // test-install.js const { enhancedLocalInstaller } = require('./src/services/enhancedLocalPluginInstaller'); enhancedLocalInstaller.installPlugin({ pluginId: '@backstage/plugin-tech-radar', version: 'latest', autoRestart: true, updateCode: true }).then(console.log).catch(console.error); ``` Run test: ```bash node test-install.js ``` ### Test Specific Plugin ```bash curl -X POST http://localhost:4400/api/plugins/install \ -H "Content-Type: application/json" \ -d '{ "pluginId": "@backstage/plugin-kubernetes", "version": "latest", "environment": "development" }' ``` ## Performance - **First Installation**: 2-3 minutes (includes NPM install and restart) - **Subsequent Installations**: 1-2 minutes (cached dependencies) - **Without Restart**: 30-60 seconds (just NPM install) ## Security Considerations 1. **NPM Package Validation**: All packages are validated against NPM registry 2. **Version Pinning**: Specific versions can be installed to avoid unexpected updates 3. **Backup System**: Files are backed up before modification 4. **Rollback Capability**: Previous versions preserved in backup directory ## Comparison with Manual Installation | Task | Manual Process | Automated Process | |------|---------------|-------------------| | Find package name | Search NPM | Automatic | | Run npm install | Manual command | Automatic | | Update package.json | Manual edit | Automatic | | Update app-config.yaml | Manual edit | Automatic | | Import in App.tsx | Manual code change | Automatic | | Add to routes | Manual code change | Automatic | | Install peer deps | Manual check & install | Automatic | | Restart Backstage | Manual Ctrl+C & npm run dev | Automatic | | Total Time | 5-10 minutes | 1-3 minutes | | Error Prone | Yes | No | ## Summary The enhanced local plugin installer transforms the development experience by providing production-like automation for plugin installation. No more manual NPM installs, config edits, or server restarts. Just click "Install" and watch the magic happen! ### Key Benefits - **Fully Automated**: Complete hands-off installation - **Fast**: 1-3 minutes from click to working plugin - **Auto-Restart**: Backstage automatically restarted - **Code Generation**: App.tsx and index.ts automatically updated - **Real-time Progress**: Watch every step of the installation - **Backup System**: Automatic backups before changes - **Production Parity**: Simulates production behavior locally Now your local development environment has the same powerful plugin management capabilities as a production Kubernetes deployment!